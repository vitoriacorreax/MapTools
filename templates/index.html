<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mapa do Estoque - Ferragem</title>
    <style>
      /* CSS interno para responsividade */
      #layout { display:grid; grid-template-columns: 1fr 360px; gap:16px; padding:16px; }
      .panel { border:1px solid #ddd; border-radius:8px; padding:12px; background:#fff; }
      .result-item { display:grid; grid-template-columns:1fr auto; gap:8px; align-items:center; }
      .chips { padding:12px 16px; display:flex; flex-wrap:wrap; gap:8px; }
      .topbar { padding:16px; border-bottom:1px solid #eab308; display:flex; gap:12px; align-items:center; justify-content:space-between; background:linear-gradient(135deg,#111827,#1f2937); color:#facc15; }
      h2 { margin:4px 0 12px; font-size:18px; }
      body { font-size:16px; line-height:1.35; }
      @media (max-width: 768px) {
        #layout { grid-template-columns: 1fr; padding:8px; gap:12px; }
        .panel { padding:10px; border-radius:10px; }
        .result-item { grid-template-columns: 1fr; }
        .chips { gap:6px; padding:8px; overflow-x:auto; white-space:nowrap; }
        .chips a { display:inline-block; }
        .topbar { flex-direction: column; align-items: stretch; }
        .topbar form { width:100%; display:flex; gap:8px; }
        .topbar form input { width:100%; flex:1; }
        .topbar form input, .topbar form button, .topbar form a { font-size:16px; padding:10px 12px !important; }
        svg { max-height: 360px; }
      }
    </style>
  </head>
  <body>
    <div class="topbar">
      <div style="display:flex;align-items:center;gap:12px;">
        {% if logo_url %}
          <img src="{{ logo_url }}" alt="Ferragem Fênix" style="width:44px;height:44px;border-radius:9999px;object-fit:cover;border:2px solid #facc15;background:#111;" />
        {% else %}
          <div style="width:44px;height:44px;border-radius:9999px;background:#facc15;color:#111;display:flex;align-items:center;justify-content:center;font-weight:800;">FF</div>
        {% endif %}
        <div>
          <div style="font-weight:800;letter-spacing:.4px;">Ferragem Fênix</div>
          <div style="font-size:12px;color:#fde68a;">Aberta todos os dias • Sempre aberta ao meio‑dia</div>
        </div>
      </div>
      <form method="get" action="/" style="display:flex;gap:8px;">
        <input name="q" value="{{ query }}" placeholder="Buscar produtos..." style="padding:8px;border-radius:8px;border:1px solid #eab308;color:#111;" />
        <button type="submit" style="padding:8px 12px;border-radius:8px;background:#facc15;color:#111;border:1px solid #eab308;">Buscar</button>
        <a href="/" style="padding:8px 12px;border:1px solid #eab308;border-radius:8px;text-decoration:none;color:#fde68a;">Limpar</a>
      </form>
    </div>

    <div id="chips" class="chips">
      <a href="/?q={{ query }}" style="padding:6px 10px;border:1px solid #ddd;border-radius:20px;text-decoration:none;{% if not active_category %}background:#eef;{% endif %}">Todas</a>
      {% for cat in categories %}
      <a href="/?q={{ query }}&cat={{ cat }}&view={{ view_mode }}&cell={{ cell_px }}" style="padding:6px 10px;border:1px solid #ddd;border-radius:20px;text-decoration:none;{% if active_category==cat %}background:#eef;{% endif %}">{{ cat }}</a>
      {% endfor %}
    </div>

    <div id="layout">
      <section class="panel" id="map-top">
        <div style="margin-bottom:12px;font-weight:700;">Mapa</div>

        {% if view_mode=='map' %}
          <h2 style="margin:4px 0 12px;">Mapa ({{ map_cfg.width }} × {{ map_cfg.height }})</h2>
          <svg viewBox="0 0 {{ svg_width }} {{ svg_height }}" width="100%" xmlns="http://www.w3.org/2000/svg" style="border:1px solid #ddd;border-radius:8px;background:#f8fafc;">
            <defs>
              <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                <feDropShadow dx="0" dy="1" stdDeviation="2" flood-color="#00000055" />
              </filter>
            </defs>
            {# links agora nos próprios retângulos de zona #}
            {% for z in svg_zones %}
              {% set is_sel = (selected_col is not none and selected_col==z.col) %}
              <a xlink:href="/?q={{ query }}&cat={{ active_category }}&view={{ view_mode }}&cell={{ cell_px }}&col={{ z.col }}">
                <rect x="{{ z.x }}" y="{{ z.y }}" rx="10" ry="10" width="{{ z.w }}" height="{{ z.h }}" fill="{{ z.fill }}" filter="url(#shadow)" stroke="{% if is_sel %}#0ea5e9{% else %}transparent{% endif %}" stroke-width="{% if is_sel %}4{% else %}0{% endif %}" />
              </a>
            {% endfor %}

            {% for it in svg_items %}
              <a id="pos-{{ it.gx }}-{{ it.gy }}" href="#pos-{{ it.gx }}-{{ it.gy }}">
                <circle cx="{{ it.cx }}" cy="{{ it.cy }}" r="{{ it.r }}" fill="{{ it.fill }}" />
              </a>
            {% endfor %}
          </svg>
        {% else %}
          <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px;">
            {% for it in items %}
            <li style="border:1px solid #ddd;border-radius:8px;padding:8px 10px;display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;">
              <div>
                <div><strong>{{ it.name }}</strong></div>
                <div style="font-size:12px;color:#555;">SKU {{ it.sku }} • {{ it.category }}</div>
                <div style="font-size:12px;color:#555;">Corredor: <strong>{{ it.aisle_display }}</strong></div>
              </div>
              <div style="text-align:right;">
                <a href="/?q={{ query }}&cat={{ active_category }}&view={{ view_mode }}&cell={{ cell_px }}&col={{ it.x }}#map-top" style="display:inline-block;margin-top:6px;padding:6px 10px;border:1px solid #aaa;border-radius:6px;text-decoration:none;color:inherit;">Ir no mapa</a>
              </div>
            </li>
            {% endfor %}
          </ul>
        {% endif %}
      </section>

      <aside class="panel">
        <h2 style="margin:4px 0 12px;">Resultados</h2>
        {% if items|length == 0 %}
          <p>Nenhum item encontrado.</p>
        {% else %}
          <ul style="list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px;">
            {% for it in items %}
            <li class="result-item" style="border:1px solid #ddd;border-radius:8px;padding:8px 10px;">
              <div>
                <div><strong>{{ it.name }}</strong></div>
                <div style="font-size:12px;color:#555;">SKU {{ it.sku }} • {{ it.category }}</div>
                <div style="font-size:12px;color:#555;">Corredor: <strong>{{ it.aisle_display }}</strong></div>
              </div>
              <div>
                <a href="/?q={{ query }}&cat={{ active_category }}&view={{ view_mode }}&cell={{ cell_px }}&col={{ it.x }}#map-top" style="display:inline-block;margin-top:6px;padding:6px 10px;border:1px solid #aaa;border-radius:6px;text-decoration:none;color:inherit;">Ir no mapa</a>
              </div>
            </li>
            {% endfor %}
          </ul>
        {% endif %}
      </aside>
    </div>

    <div style="padding:12px 16px;border-top:1px solid #ddd;color:#666;">
      <small>Exemplo educacional - Universidade</small>
    </div>
  </body>
  </html>


